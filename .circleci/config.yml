version: 2.1
jobs:
  build:
    docker:
      - image: cimg/base:2024.01
      
    environment:
      JAVA_HOME: /usr/lib/jvm/java-17-openjdk-amd64/
      NVM_DIR: /home/circleci/.nvm
      ANDROID_HOME: /usr/lib/android-sdk
    steps:
      # install nesessary dependencies holaa
      #- run: sudo apt update
      #- run: sudo apt install nodejs
      #- run: sudo apt install npm
      - run:
          name: install Main dependecies
          command: |
            sudo apt update
            sudo apt install nodejs
            sudo apt install npm
            curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.7/install.sh | bash
            export NVM_DIR="$HOME/.nvm"
            [ -s "$NVM_DIR/nvm.sh" ] && \. "$NVM_DIR/nvm.sh"
            nvm --version
            nvm install 16
            nvm use 16
            npm install appium
            sudo apt install openjdk-17-jdk
            sudo apt-get -y install jaxb
            echo -e "\e[31m ************ Install Android tools ************ \e[0m"   
            cd /usr/lib/jvm/
            ls -l
      - run:
          name: install android SDK
          command: |
            wget https://dl.google.com/android/repository/commandlinetools-linux-6609375_latest.zip
            unzip commandlinetools-linux-6609375_latest.zip
      - run:
          name: install android system
          command: |
            echo y | ./tools/bin//sdkmanager "system-images;android-30;google_apis;x86_64"

      #- run: npm install android-platform-tools
      #- run: sudo apt install openjdk-17-jdk
      #- run: npm install appium
      #- run: npm install android-platform-tools
      #- run: npm install appium-doctor
      # configuration of dependecies environment
      #- run: export JAVA_HOME=/usr/lib/jvm/java-17-openjdk-amd64/bin/java
      #- run: export PATH=$PATH:$JAVA_HOME/bin
      #- run: sudo update-alternatives --config java
      
      # - run: sdkmanager
      # see correct dependeci installed
      - run: echo $JAVA_HOME
      - run: echo $ANDROID_HOME
      #- run: echo $PATH
      - run: java --version
      - run: node --version
      - run: npm --version
      - run: npx appium-doctor
runworkflows:
  version: 2
  scheduled-workflow-android:
    jobs:
    - build
